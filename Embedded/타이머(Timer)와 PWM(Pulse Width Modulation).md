## 타이머(Timer)
타이머란 말 그대로 시간을 측정하는 내부 장치이다.

<br>

## 대표적인 타이머
대표적인 타이머로 범용, 고급, 기본, 채널 타이머가 있다.
- 범용(General Purpose) 타이머 : 출력 비교, 원펄스 입력 캡처, 센서 인터페이스 등의 용도로 사용하는 기본 타이머
- 고급(Advanced) 타이머 : 범용 타이머보다 더 많은 기능을 가지는 타이머로, 3상 출력, 비상 셧다운 입력 등의 기능이 추가됨
- 기본(Basic) 타이머 : 입출력 기능은 없고 시간 기반 타이머나 DAC 트리거 용도로만 사용되는 타이머
- 채널(Channel) 타이머 : 범용 타이머와 기능은 동일하나 채널을 1 ~ 2개만 가지는 타이머
- Sys(시스템)Tick 타이머 : 시스템 틱으로 항상 동작하는 시스템 타이머
- 와치독(WatchDog) 타이머 : CPU의 오동작을 감지하여 문제가 발생하면 재부팅 시켜주는 타이머

<br>

## 타이머의 주요 구성 요소

### 프리스케일러(PSC, Prescaler)
- 타이머에 공급되는 입력 클럭의 속도를 조절하는 분주기
- 공급되는 클럭을 1 ~ 65,536(16 bit, 타이머 bit 수)의 값으로 나누어 사용

<br>

### 카운터(CNT, Counter)
- 타이머에 공급되는 클럭을 이용한 업, 다운, 업/다운 카운팅 설정 가능

<br>

### 오토 리로드 레지스터(ARR, Auto Reload Register)
- 타이머의 카운팅 기준이 되는 레지스터
- 업 카운터의 경우 CNT 값이 ARR의 설정 값과 같아질 경우 Count 값을 0부터 다시 시작
- 다운 카운터의 경우 CNT 값이 0이 될 경우 Count 값을 0부터 다시 시작

<br>

### 캡쳐/비교기(CCR, Capture/Compare Register)
- 입력 신호가 주어질 때 카운터 값을 캡처
- Count의 값이 CCR과 같아질 경우 인터럽트를 발생하거나 출력 채널을 0 또는 1 출력

<br>

## 타이머의 주요 모드

### 업 카운팅 모드(Up Counting) 모드
- CNT의 값이 증가하면서 Counting을 하는 모드
- CNT의 값이 0부터 시작해서 CNT의 값이 ARR의 값과 같아질 경우까지 증가
- CNT의 값이 ARR의 값과 같아질 경우 다시 0부터 Counting
- CNT가 0이 될 때 오버플로우, 업데이트 이벤트(UEV)와 업데이트 인터럽트(UI)가 발생

<br>

### 다운 카운팅(Down Counting) 모드
- CNT의 값이 감소하면서 Counting을 하는 모드
- CNT의 값이 ARR의 값 부터 CNT가 0이 되었을 때 까지 감소
- CNT의 값이 0이 되었을 경우 다시 ARR의 부터 Counting
- CNT가 ARR의 값이 되었을 때 언더플로우, 업데이트 이벤트(UEV), 업데이트 인터럽트(UI), 업데이트 인터럽트 플래그(UIF) 발생

<br>

### 업/다운 카운팅(Up/Down Counting) 모드
- CNT의 값이 증가한 후 다시 감소하면서 Counting을 하는 모드
- CNT는 0부터 ARR 값 까지 증가한 후 다시 0까지 감소 동작을 반복(증가 -> 감소 -> 증가 -> 감소)하며 Counting함
- CNT가 0이 될 때 오버플로우, 업데이트 이벤트(UEV)와 업데이트 인터럽트(UI)가 발생
- CNT가 ARR의 값이 되었을 때 언더플로우, 업데이트 이벤트(UEV), 업데이트 인터럽트(UI), 업데이트 인터럽트 플래그(UIF) 발생
- 센터 얼라인(Center Aligned) 모드라고도 함

<br>

### 입력 캡쳐(Input Capture) 모드
- 입력 캡쳐 모드는 외부의 입력 값이 들어오는 순간 그 때의 카운터 값을 캡쳐하여 동작하는 모드
- 입력 캡쳐 신호가 입력되면 그 때의 카운터 값이 비교/비교기에 저장되며 캡쳐 플래그가 설정되고 인터럽트가 Enable 되어 있는 경우 인터럽트가 발생함
- 캡쳐 플래그가 이미 설정되어 있는데 캡쳐가 또 발생하는 경우 오버 캡쳐 플래그가 설정됨

<br>

### 출력 비교 모드(Output Compare) 모드
- zCNT의 출력 값이 캡쳐/비교기에 설정된 비교값과 일치할 때 인터럽트나 해당 핀에 출력이 발생하는 모드

<br>

### PWM(Pulse Width Modulation) 모드
- PWM 출력을 발생시키는 모드
- 출력의 주파수는 ARR 값에 의해 결정되며 듀티 비(Duty Rate)는 CCR에 의해 결정

<br>

### 원 펄스(One Pulse) 모드
- 외부 입력이 인가될 경우 이로부터 일정 시간이 지난 후 펄스를 1번 발생시키는 모드
- 펄스가 발생하는 시간과 지속 가능한 시간은 프로그래밍으로 제어 가능


<br>

## PWM(Pulse Width Modulation)
PWM은 펄스폭 변조라고도 하며, 디지털 출력을 통해 아날로그 값을 제어하는 방식이다.
<br>
디지털 신호는 0과 1밖에 없기 때문에 이 비율을 이용해 아날로그 값을 조절하는 것이다.
<br>
이때 이 비율을 듀티 사이클(Duty Cycle) 이라고 한다.

<br>

## 타이머 주기 설정

```
Period : 타이머 주기 값
Prescaler : 타이머 분주비 값
Clock : 시스템 Clock 속도

Example)
Period (1/APB1) Prescaler
0.01 초 = 900 (1/900MHz) 1000
```
